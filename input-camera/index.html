<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Input Video</title>
	<link rel="stylesheet" href="../style.css">
	<style>
		video {
			background-color: #ccc;
			margin: 2.618em 0;
		}
		#video-input-container {
			text-align: center;
		}
	</style>
</head>
<body>
	<div class="container">

		<h1>カメラの映像を入力</h1>
		<div id="video-input-container">
			<video id="video" width="640" height="360" autoplay muted></video>
			<!-- autoplay属性がないと映像が止まる -->
			<button id="button" class="button">Start</button>

			<p style="margin: 2em 0;">Firefox, Chrome 以外では動かないかもしれません</p>
		</div>


	</div><!-- /container -->

	<script>

		// 参考： https://html5experts.jp/mganeko/19728/

		let video = document.getElementById('video');
		let localStream;

		function startVideo() {
			navigator.mediaDevices.getUserMedia({
				video: {
					width: 640,
					height: 360
				},
				audio: false,
			}).then(function (stream) { // success
				localStream = stream;
				video.src = window.URL.createObjectURL(localStream);
			}).catch(function (error) { // error
				console.error('mediaDevice.getUserMedia() error:', error);
				return;
			});
		}

		document.getElementById('button').addEventListener('click', function() {
			startVideo();
		});

	</script>
</body>
</html>